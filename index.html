<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#121212">
<meta charset="UTF-8">
<title>Mon Organisation</title>
  
<style>
/* ==========================
   üåü STYLES G√âN√âRAUX
========================== */ 
body {font-family: Arial, sans-serif; padding: 15px;  margin: 0; width: 100%; }
html, body {height: 100%;}
h1 { color: #2c3e50; text-align: center; }
label { display: block; margin-top: 10px; }
input, select, button { margin: 5px 0; padding: 10px; font-size: 1em; width: 100%; box-sizing: border-box; }
button.small {padding: 6px 10px; font-size: 0.9em; min-width: 90px; }
.nav {display: flex; gap: 10px; margin-bottom: 15px; }
.nav button {flex: 1; }
  
/* ==========================
   ‚ö° PAGES
========================== */
.page {display: none; }

  /* ==========================
   üè† PAGE ACCUEIL
========================== */
.home-grid {display: flex; flex-direction: column; gap: 20px; margin-top: 40px; }
.home-btn {padding: 25px; font-size: 1.4em; border-radius: 15px; cursor: pointer; width: 100%; }

  /* ==========================
   üçΩ ALIMENTAIRE
========================== */
ul { list-style: none; padding: 0; max-height: 400px; overflow-y: auto; margin-top: 10px; }
li { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin:5px 0; border-bottom:1px solid #ccc; padding:5px; 
    word-wrap:break-word; }
.actions {display: inline-flex; gap: 6px; margin-left: 10px; }
.urgent {color: red; font-weight: bold; display: flex; align-items: center; flex: 1; }
.ok {color: black; display: flex; align-items: center; flex: 1; }
.course-checkbox {width: 20px; height: 20px; cursor: pointer; }
.form-section {margin-bottom: 25px; }
#listeAliments {min-height: calc(100vh - 300px); overflow-y: auto; }
.repas-actions {display: flex; gap: 12px; margin-top: 15px; }
.repas-actions button {flex: 1; padding: 12px; font-size: 1em; }

/* ==========================
   üßΩ PROPRET√â
========================== */
.room {margin-top: 20px; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.05); }
.task {display: flex; align-items: center; gap: 10px; padding: 8px 0; font-size: 1.1em; }
.task input {width: 22px; height: 22px; }
.progress-fill {height: 100%; width: 0%; background: #2ecc71; transition: width 0.3s ease; }
.proprete-page {display: none; }
.progress-bar {height: 10px; background: #ddd; border-radius: 10px; overflow: hidden; margin: 6px 0 12px 0; }

/* ==========================
   üåô MODE SOMBRE
========================== */
.dark {background: #121212; color: #e0e0e0; }
.dark input, .dark select, .dark button {background: #1e1e1e; color: #e0e0e0; border: 1px solid #444; }
.dark li {border-bottom: 1px solid #333; }
.dark strong, .dark li span, .dark h1, .dark h2 {color: #ffffff; }
.dark .room {background: rgba(255,255,255,0.05); }
.toggle {margin: 10px 0; }
.dark .progress-bar {background: #333;}

/* ==========================
   üñ§ POPUPS
========================== */
/* POPUPS */
.popup {
  display: none; /* masqu√© par d√©faut */
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5); /* fond semi-transparent */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.popup-content {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  position: relative;
}

.popup-content h3 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 1.3rem;
  text-align: center;
}

.popup-content input,
.popup-content select,
.popup-content textarea {
  width: 100%;
  padding: 8px 10px;
  margin: 5px 0 10px 0;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
  box-sizing: border-box;
}

.popup-content textarea {
  resize: vertical;
  min-height: 60px;
}

.popup-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 10px;
}

.popup-actions button {
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.95rem;
  transition: background 0.2s;
}

.popup-actions button:hover {
  opacity: 0.9;
}

.popup-actions button.delete-btn {
  background: #e74c3c;
  color: white;
}

.popup-actions button.delete-btn:hover {
  background: #c0392b;
}

.popup-actions button:first-of-type {
  background: #3498db;
  color: white;
}

.popup-actions button:first-of-type:hover {
  background: #2980b9;
}

.popup-actions button:nth-child(2) {
  background: #95a5a6;
  color: white;
}

.popup-actions button:nth-child(2):hover {
  background: #7f8c8d;
}

/* BOUTONS GENERAUX */
button {
  cursor: pointer;
  border-radius: 6px;
  border: none;
  padding: 6px 12px;
  background: #3498db;
  color: white;
  font-size: 0.95rem;
  transition: background 0.2s;
}

button:hover {
  background: #2980b9;
}

/* ALIMENTS / RECETTES LISTE */
.aliment, .recette {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

/* INPUTS REPAS */
.semaine input.repas {
  width: calc(33% - 10px);
  margin: 5px;
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

/* Responsive pour petits √©crans */
@media (max-width: 480px) {
  .popup-content {
    width: 95%;
  }
  .semaine input.repas {
    width: 100%;
    margin: 5px 0;
  }
}


/* ==========================
    TELEPHONE
========================== */
@media (max-width: 600px) {
  .popup-content {width: 95%; height: auto; padding: 20px; border-radius: 10px; }
  body { padding: 10px; }
  input, select, button { width: 100%; }
}
</style>
</head>
  
<body>

<!-- ==========================
   üè† ACCUEIL
========================== -->
<div id="page-accueil" class="page">
  <h1 style="text-align:center;">üè† Mon organisation</h1>
  <div class="home-grid">
  <button class="home-btn" onclick="afficherPage('alimentaire')">ü•ó Alimentaire</button>
  <button class="home-btn" onclick="afficherPage('proprete')">üßΩ Propret√©</button>
  <button class="home-btn" onclick="afficherPage('budget')">üí∞ Budget</button>
  </div>
</div>

<button class="toggle" onclick="toggleDarkMode()">üåô Mode sombre</button>

<!-- ==========================
   üçΩ ALIMENTAIRE
========================== -->  
<div id="page-alimentaire" class="page" style="display:none;">
  <h1>Gestion Alimentaire</h1>
  <button class="small" onclick="afficherPage('accueil')">‚¨Ö Retour</button>

  <!--Onglets-->
  <nav class="nav">
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherSousPage('inventaire')">üì¶ Inventaire</button>
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherSousPage('repas')">üçΩÔ∏è Repas</button>
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherSousPage('recettes')">üìñ Recettes</button>
  </nav>
  
  <!-- ===== INVENTAIRE ===== -->
  <div id="inventaire" style="margin-bottom:10px;">
    <button onclick="exporterInventaire()">üíæ Sauvegarder</button>
    <input type="file" id="importFile" accept=".json" onchange="importerInventaire(event)">
   
    <label>Nom :</label>
    <input type="text" id="nom" placeholder="Nom de l'aliment">
    
    <label>Quantit√© :</label>
    <input type="number" id="quantite" placeholder="Quantit√©">
    
    <label>Unit√© :</label>
    <input type="text" id="unite" placeholder="Ex: g, litre, pcs">
    
    <label>Date de p√©remption :</label>
    <div style="display: flex; align-items: center; gap: 10px;">
      <input type="date" id="peremption">
      <label style="display: flex; align-items: center; gap: 5px; margin: 0;">
        <input type="checkbox" id="sansDate" style="transform: scale(1.5);">
        <span style="white-space: nowrap;">Pas de DLC</span>
      </label>
    </div>
    
    <label>Cat√©gorie :</label>
    <select id="categorie">
      <option value="Choisir cat√©gorie">Choisir cat√©gorie</option>
      <option value="Boisson">Boisson</option>
      <option value="Produit laitier">Produit laitier</option>
      <option value="L√©gume">L√©gume</option>
      <option value="Fruit">Fruit</option>
      <option value="Viande">Viande</option>
      <option value="Poisson">Poisson</option>
      <option value="F√©culent">F√©culent</option>
      <option value="Sucr√©">Sucr√©</option>
      <option value="Sauce">Sauce</option>
      <option value="Epice">Epice</option>
      <option value="Sec">Sec</option>
      <option value="Plat pr√©par√©">Plat pr√©par√©</option>
      <option value="Hygi√®ne">Hygi√®ne</option>
    </select>

    <div class="form-section">
      <button type="button" onclick="ajouterOuModifierAliment()">Ajouter</button>
    </div>

    <input type="text" id="recherche" placeholder="üîç Rechercher un aliment..." oninput="afficherAliments()">
    <h2>Liste des aliments :</h2>
    <ul id="listeAliments"></ul>
  </div>

  <!-- ===== REPAS ===== -->
  <div id="repas" style="display:none;">
    <h2>üçΩÔ∏è Repas de la semaine</h2>
    <p>Planifie les repas de la semaine :</p>
  
    <div style="display: flex; align-items: flex-end; gap: 10px; margin-top: 20px;">
      <table border="1" cellpadding="5" cellspacing="0">
          <thead>
            <tr>
              <th>Jour</th>
              <th>Petit-d√©jeuner</th>
              <th>D√©jeuner</th>
              <th>D√Æner</th>
              <th>Autre</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Lundi</td>
              <td><input type="text" class="repas" data-jour="Lundi" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Lundi" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Lundi" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Lundi" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
            <tr>
              <td>Mardi</td>
              <td><input type="text" class="repas" data-jour="Mardi" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Mardi" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Mardi" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Mardi" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
            <tr>
              <td>Mercredi</td>
              <td><input type="text" class="repas" data-jour="Mercredi" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Mercredi" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Mercredi" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Mercredi" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
            <tr>
              <td>Jeudi</td>
              <td><input type="text" class="repas" data-jour="Jeudi" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Jeudi" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Jeudi" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Jeudi" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
            <tr>
              <td>Vendredi</td>
              <td><input type="text" class="repas" data-jour="Vendredi" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Vendredi" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Vendredi" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Vendredi" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
            <tr>
              <td>Samedi</td>
              <td><input type="text" class="repas" data-jour="Samedi" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Samedi" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Samedi" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Samedi" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
            <tr>
              <td>Dimanche</td>
              <td><input type="text" class="repas" data-jour="Dimanche" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Dimanche" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Dimanche" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>
              <td><input type="text" class="repas" data-jour="Dimanche" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>
            </tr>
          </tbody>
        </table>
        <button onclick="nouvelleSemaine()" style="background-color:#e74c3c; color:white; padding: 6px 12px; border:none; border-radius:5px; cursor:pointer; 
          font-size: 0.9em;height: fit-content;width: auto !important;"> Nouvelle semaine</button>
    </div>
    <div class="repas-actions">
      <button onclick="sauvegarderRepas()">üíæ Sauvegarder</button>
      <button onclick="chargerRepas()">üîÑ Charger</button>
      <button onclick="genererListeCourses()">üõí Liste de courses</button>
    </div>
    <div id="repasSemaine"></div>
  </div>

  <!-- ===== RECETTES ===== -->
  <div id="recettes" style="display:none;">
    <h2>üìñ Mes Recettes</h2>
    <label>Nom de la recette :</label>
    <input type="text" id="recetteNom" placeholder="Nom de la recette">
    <label>Ingr√©dients (s√©par√©s par des virgules) :</label>
    <input type="text" id="recetteIngredients" placeholder="Ex: Tomate, Lait, Oeuf">
    <div class="form-section">
      <button type="button" onclick="ajouterRecette()">Ajouter la recette</button>
    </div>
    <h3>Liste des recettes :</h3>
    <ul id="listeRecettes"></ul>
  </div>
</div>
  
<!-- ==========================
   üßΩ PROPRET√â
========================== -->
<div id="page-proprete" class="page" style="display:none;">
  <h2>üßΩ Propret√©</h2>
  <button class="small" onclick="afficherPage('accueil')">‚¨Ö Retour</button>
  
  <!-- Onglets -->
  <nav class="nav">
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherOngletProprete('menage')">üè† Appartement</button>
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherOngletProprete('voiture')">üöó Voiture</button>
  </nav>

  <!-- ===== Appartement ===== -->
  <div id="proprete-menage" class="proprete-page">
    <div id="liste-menage"></div>
    <button onclick="resetProprete('menage')">üîÑ Nouvelle semaine</button>
  </div>

  <!-- ===== Voiture ===== -->
  <div id="proprete-voiture" class="proprete-page">
    <div id="liste-voiture"></div>
    <button onclick="resetProprete('voiture')">üîÑ Reset voiture</button>
  </div>
  
</div>

<!-- ==========================
   üí∞ BUDGET
========================== -->
<div id="page-budget" class="page" style="display:none;">
  <h2>üí∞ Budget mensuel</h2>
  <button class="small" onclick="afficherPage('accueil')">‚¨Ö Retour</button>

  <!-- Onglets -->
  <nav class="nav">
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherBudgetOnglet('depenses')" class="budget-tab">D√©penses</button>
    <button style="width:auto; padding:10px; font-size:1em;" onclick="afficherBudgetOnglet('graphique')" class="budget-tab">Graphique</button>
  </nav>

  <!-- ===== Depense ===== -->
  <div id="inventaire" style="margin-bottom:10px;">
  <div id="budget-depenses" style="margin-top: 20px;">
    <h3>Ajouter une d√©pense</h3>
    <label>Montant (‚Ç¨)</label>
    <input type="number" id="budgetMontant" placeholder="Ex: 25">

    <label>Cat√©gorie</label>
    <select id="budgetCategorie">
      <option>Nourriture</option>
      <option>Logement</option>
      <option>Voiture</option>
      <option>Loisir</option>
      <option>Sant√©</option>
      <option>Abonnement</option>
      <option>Autre</option>
    </select>

    <label>Description</label>
    <input type="text" id="budgetNote" placeholder="Ex: courses lidl">

    <button onclick="ajouterDepense()">Ajouter</button>
    <hr>
    <h3>Total du mois : <span id="budgetTotal">0 ‚Ç¨</span></h3>
    <h3>D√©penses :</h3>
    <ul id="budgetListe"></ul>
  </div>

  <!-- ===== Graphique ===== -->
  <div id="inventaire" style="margin-bottom:10px;">
  <div id="budget-graphique" style="display:none;">
    <canvas id="budgetPieChart" width="300" height="300"></canvas>
    <ul id="budgetLegend" style="list-style:none; padding:0; margin-top:10px;"></ul>
  </div>
</div>

<!-- ==========================
   POPUPS
========================== -->
<!-- ALIMENTS -->
<div id="listeAliments">
  <div class="aliment">
    <span>Nom Aliment</span>
    <button class="edit-btn" data-index="0">Modifier</button>
  </div>
  <!-- r√©p√©ter pour chaque aliment -->
</div>

<!-- POPUP MODIFIER ALIMENT -->
<div id="popupEdit" class="popup">
  <div class="popup-content">
    <h3>Modifier Aliment</h3>
    <input id="editNom" placeholder="Nom">
    <input id="editQuantite" type="number" placeholder="Quantit√©">
    <input id="editUnite" placeholder="Unit√©">
    <input id="editPeremption" type="date">
    <label><input type="checkbox" id="editSansDate"> Sans date</label>
    <select id="editCategorie"></select>
    <div class="popup-actions">
      <button>Sauvegarder</button>
      <button>Annuler</button>
      <button class="delete-btn">Supprimer</button>
    </div>
  </div>
</div>

<!-- RECETTES -->
<div id="listeRecettes">
  <div class="recette">
    <span>Nom Recette</span>
    <button>Ajouter au repas</button>
  </div>
  <!-- r√©p√©ter pour chaque recette -->
</div>

<!-- POPUP AJOUTER RECETTE AU REPAS -->
<div id="popupRecette" class="popup">
  <div class="popup-content">
    <h3>Ajouter recette au repas</h3>
    <label>Jour
      <select id="recetteJour">
        <option value="lundi">Lundi</option>
        <option value="mardi">Mardi</option>
        <!-- autres jours -->
      </select>
    </label>
    <label>Repas
      <select id="recetteTypeRepas">
        <option value="petitDej">Petit-d√©jeuner</option>
        <option value="dejeuner">D√©jeuner</option>
        <option value="diner">D√Æner</option>
      </select>
    </label>
    <div class="popup-actions">
      <button>Ajouter</button>
      <button>Annuler</button>
    </div>
  </div>
</div>

<!-- POPUP MODIFIER REPAS -->
<div id="popupRepasEdit" class="popup">
  <div class="popup-content">
    <h3 id="repasTitre">Modifier repas</h3>
    <textarea id="repasTexte"></textarea>
    <div class="popup-actions">
      <button>Sauvegarder</button>
      <button>Annuler</button>
    </div>
  </div>
</div>

<!-- INPUTS REPAS -->
<div class="semaine">
  <input class="repas" data-jour="lundi" data-repas="petitDej" placeholder="Petit-d√©j">
  <input class="repas" data-jour="lundi" data-repas="dejeuner" placeholder="D√©jeuner">
  <input class="repas" data-jour="lundi" data-repas="diner" placeholder="D√Æner">
  <!-- r√©p√©ter pour chaque jour -->
</div>

<script>
// ------------------- MODE SOMBRE -------------------
if (localStorage.getItem("darkMode") === "true") {
  document.body.classList.add("dark");
}
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
}

/* =========================
   Initialisation variable
========================= */
let aliments = [];
let indexEnCours = -1;
let categoriesCourses = JSON.parse(localStorage.getItem("categoriesCourses")) || {};
const toutesCategories = ["F√©culent", "Produit laitier", "Viande", "Poisson", "Fruit", "L√©gume", "Sucr√©", "Sauce", "Epice", "Boisson", "Conserve", 
                          "Produit du monde", "Hygi√®ne"];
let recettes = [];
let indexRecetteEnCours = -1;
let depenses = [];

/* =========================
   Alimentaire
========================= */
// Charger les aliments depuis localStorage
function chargerAliments() {
  const data = localStorage.getItem("aliments");
  if(data) aliments = JSON.parse(data);
}
// Sauvegarder les aliments dans localStorage
function sauvegarderAliments() {
  localStorage.setItem("aliments", JSON.stringify(aliments));
}
// Ajouter ou modifier un aliment
function ajouterOuModifierAliment() {
  const nom = document.getElementById("nom").value;
  const quantite = document.getElementById("quantite").value;
  const unite = document.getElementById("unite").value;
  const sansDate = document.getElementById("sansDate").checked;
  const peremption = sansDate ? null : document.getElementById("peremption").value;
  const categorie = document.getElementById("categorie").value;
  if(!nom || !quantite || !unite || !categorie) {
    alert("Veuillez remplir tous les champs !");
    return;
  }
  const nouvelAliment = {nom, quantite, unite, peremption, categorie};
  if(indexEnCours === -1) {
    aliments.push(nouvelAliment);
  } else {
    aliments[indexEnCours] = nouvelAliment;
    indexEnCours = -1;
    document.querySelector("button[onclick='ajouterOuModifierAliment()']").textContent = "Ajouter";
  }
  // R√©initialiser le formulaire
  document.getElementById("nom").value = "";
  document.getElementById("quantite").value = "";
  document.getElementById("unite").value = "";
  document.getElementById("peremption").value = "";
  document.getElementById("categorie").value = "Choisir cat√©gorie";
  document.getElementById("sansDate").checked = false; 
  sauvegarderAliments();
  afficherAliments();
}

// Affichage
function calculerJoursRestants(dateString) {
  const aujourdHui = new Date();
  const peremption = new Date(dateString);
  const diffTime = peremption - aujourdHui;
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return diffDays < 0 ? 0 : diffDays;
}
function afficherAliments() {
  const recherche = document.getElementById("recherche").value.toLowerCase();
  const ul = document.getElementById("listeAliments");
  ul.innerHTML = "";
  const ordreCategorie = ["F√©culent", "Produit laitier", "Viande", "Poisson", "Fruit", "L√©gume", "Sucr√©", "Sec", "Sauce", "Epice", "Boisson", " Plat pr√©par√©", "Hygi√®ne"];
  aliments.sort((a,b) => ordreCategorie.indexOf(a.categorie) - ordreCategorie.indexOf(b.categorie));
  let categorieActuelle = "";
  aliments.forEach((aliment, index) => {
    if(!aliment.nom.toLowerCase().includes(recherche)) return;
    // Si on change de cat√©gorie ‚Üí afficher le titre
    if(aliment.categorie !== categorieActuelle) {
      categorieActuelle = aliment.categorie;
      const titre = document.createElement("li");
      titre.innerHTML = `<strong style="font-size:1.2em; color:#2c3e50;">${categorieActuelle}</strong>`;
      ul.appendChild(titre);
    }
    const li = document.createElement("li");
    li.style.cursor = "pointer";
    li.onclick = (e) => {
      if (e.target.tagName !== "BUTTON") ouvrirPopup(index);
    };
    const joursRestants = calculerJoursRestants(aliment.peremption);
    let texte = `${aliment.nom} - ${aliment.quantite} ${aliment.unite}`;
    if (aliment.peremption) {
      texte += ` - ${joursRestants} jour(s) restant`;
    } else {
      texte += " - Dur√©e illimit√©e";
    }
    if (aliment.peremption && calculerJoursRestants(aliment.peremption) <= 3) {
      li.className = "urgent";
      texte += " - URGENT !";
    } else {
      li.className = "ok";
    }
    const spanTexte = document.createElement("span");
    spanTexte.textContent = texte;
    li.appendChild(spanTexte);
    const btnSupprimer = document.createElement("button");
    btnSupprimer.textContent = "Supprimer";
    btnSupprimer.style.padding = "10px 16px";
    btnSupprimer.style.fontSize = "1em";
    btnSupprimer.style.background = "#e74c3c";
    btnSupprimer.style.color = "white";
    btnSupprimer.style.border = "none";
    btnSupprimer.style.borderRadius = "6px";
    btnSupprimer.onclick = () => supprimerAliment(index);
    const actions = document.createElement("span");
    actions.className = "actions";
    actions.appendChild(btnSupprimer);
    li.appendChild(actions);
    ul.appendChild(li);
  });
}
function supprimerAliment(index) {
  if(confirm("Voulez-vous vraiment supprimer cet aliment ?")) {
    aliments.splice(index, 1);
    sauvegarderAliments();
    afficherAliments();
  }
}
// Pr√©-remplir le formulaire pour modifier
function preRemplirFormulaire(index) {
  const aliment = aliments[index];
  document.getElementById("nom").value = aliment.nom;
  document.getElementById("quantite").value = aliment.quantite;
  document.getElementById("unite").value = aliment.unite;
  document.getElementById("peremption").value = aliment.peremption;
  document.getElementById("categorie").value = aliment.categorie;
  indexEnCours = index;
  document.querySelector("button[onclick='ajouterOuModifierAliment()']").textContent = "Modifier";
}
// Sauvegarde inventaire
function exporterInventaire() {
  const dataStr = JSON.stringify(aliments, null, 2);
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "inventaire.json";
  a.click();
  URL.revokeObjectURL(url);
}
function importerInventaire(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      aliments = JSON.parse(e.target.result);
      sauvegarderAliments();
      afficherAliments();
      alert("Inventaire restaur√© avec succ√®s !");
    } catch {
      alert("Fichier invalide");
    }
  };
  reader.readAsText(file);
}

/* =========================
   Repas
========================= */
function sauvegarderRepas() {
  const repasData = {};
  document.querySelectorAll('.repas').forEach(input => {
    const jour = input.dataset.jour;
    const typeRepas = input.dataset.repas;
    if (!repasData[jour]) repasData[jour] = {};
    repasData[jour][typeRepas] = input.value;
  });
  localStorage.setItem('repasSemaine', JSON.stringify(repasData));
  alert("Repas sauvegard√©s !");
}
function chargerRepas() {
  const repasData = JSON.parse(localStorage.getItem('repasSemaine'));
  if (!repasData) return;

  document.querySelectorAll('.repas').forEach(input => {
    const jour = input.dataset.jour;
    const typeRepas = input.dataset.repas;
    input.value = repasData[jour] ? repasData[jour][typeRepas] || '' : '';
  });
}
function genererListeCourses() {
  let inventaire = [];
  try {
    inventaire = JSON.parse(localStorage.getItem('aliments')) || [];
  } catch {
    inventaire = [];
  }
  const repasData = JSON.parse(localStorage.getItem('repasSemaine')) || {};
  let categories = JSON.parse(localStorage.getItem("coursesCategories")) || {};
  const totalDemandes = {};
  Object.values(repasData).forEach(jour => {
    Object.values(jour).forEach(texteRepas => {
      if (!texteRepas) return;
      const aliments = texteRepas.split(',').map(a => a.trim()).filter(a => a);
      aliments.forEach(item => {
        const match = item.match(/^(.+?)\s*(\d+)?$/);
        if (!match) return;
        const nom = match[1].trim();
        const qte = Number(match[2]) || 1;
        totalDemandes[nom] = (totalDemandes[nom] || 0) + qte;
        if (!categories[nom]) {
          categories[nom] = "Autres";
        }
      });
    });
  });
  const courses = {};
  Object.keys(totalDemandes).forEach(nom => {
    const trouve = inventaire.find(a =>
      a.nom.toLowerCase() === nom.toLowerCase()
    );
    const stock = trouve ? Number(trouve.quantite) : 0;
    const besoin = Math.max(totalDemandes[nom] - stock, 0);

    if (besoin > 0) {
      courses[nom] = besoin;
    }
  });
  const container = document.getElementById("repasSemaine");
  container.innerHTML = "";
  const headerWrapper = document.createElement("div");
  headerWrapper.style.display = "flex";
  headerWrapper.style.alignItems = "center";
  headerWrapper.style.justifyContent = "space-between";
  headerWrapper.style.marginBottom = "10px";
  const titre = document.createElement("h3");
  titre.textContent = "üõí Liste de courses";
  titre.style.fontSize = "1.4em";
  headerWrapper.appendChild(titre);
  const btnAjouterInventaire = document.createElement("button");
  btnAjouterInventaire.textContent = "‚ûï Ajouter √† l'inventaire";
  btnAjouterInventaire.className = "small"; // m√™me style que bouton supprimer
  btnAjouterInventaire.style.padding = "6px 12px"; // m√™me que supprimer
  btnAjouterInventaire.style.flexShrink = "0";      // ne pas √©tirer
  btnAjouterInventaire.style.width = "auto";       
  btnAjouterInventaire.onclick = () => {
    const checkedData = JSON.parse(localStorage.getItem("coursesChecked")) || {};
    Object.keys(checkedData).forEach(nom => {
      if (checkedData[nom]) {
        aliments.push({
          nom: nom,
          quantite: courses[nom],
          unite: "",
          peremption: null,
          categorie: "Choisir cat√©gorie"
        });
        delete checkedData[nom];
      }
    });
    localStorage.setItem("aliments", JSON.stringify(aliments));
    localStorage.setItem("coursesChecked", JSON.stringify(checkedData));
    genererListeCourses();
    afficherAliments();
  };
  headerWrapper.appendChild(btnAjouterInventaire);
  container.appendChild(headerWrapper);
  if (Object.keys(courses).length === 0) {
    container.innerHTML += "<p>‚úÖ Tout est d√©j√† dans l'inventaire.</p>";
    return;
  }
  const ordreCategories = [
    "Autres",
    "F√©culent", "Produit laitier", "Viande", "Poisson",
    "Fruit", "L√©gume", "Sucr√©", "Sauce",
    "Epice", "Boisson", "Conserve", "Produit du monde", "Hygi√®ne"
  ];
  ordreCategories.forEach(categorie => {
    const alimentsDeCategorie = Object.keys(courses)
      .filter(nom => categories[nom] === categorie);
    if (alimentsDeCategorie.length === 0) return;
    const titreCat = document.createElement("p");
    titreCat.textContent = categorie;
    titreCat.style.fontWeight = "bold";
    titreCat.style.fontSize = "1.25em";
    titreCat.style.marginTop = "10px";
    container.appendChild(titreCat);
    const ul = document.createElement("ul");
    alimentsDeCategorie.forEach(nom => {
      const li = document.createElement("li");
      li.style.fontSize = "1.1em";
      li.style.display = "flex";
      li.style.alignItems = "center";
      li.style.gap = "10px";
      const checkedData = JSON.parse(localStorage.getItem("coursesChecked")) || {};
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.className = "course-checkbox";
      checkbox.checked = checkedData[nom] || false;
      const span = document.createElement("span");
      span.textContent = `${nom} x${courses[nom]}`;
      span.style.flex = "1";
      if (checkbox.checked) {
        span.classList.add("course-checked");
      }
      checkbox.onchange = () => {
        const data = JSON.parse(localStorage.getItem("coursesChecked")) || {};
        data[nom] = checkbox.checked;
        localStorage.setItem("coursesChecked", JSON.stringify(data));
        span.classList.toggle("course-checked", checkbox.checked);
      };
      const select = document.createElement("select");
      const optionModifier = document.createElement("option");
      optionModifier.textContent = "Modifier";
      optionModifier.selected = true;
      optionModifier.disabled = true;
      select.appendChild(optionModifier);
      ordreCategories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
      select.onchange = () => {
        categories[nom] = select.value;
        localStorage.setItem("coursesCategories", JSON.stringify(categories));
        genererListeCourses();
      };
      li.appendChild(checkbox);
      li.appendChild(span);
      li.appendChild(select);
      ul.appendChild(li);
    });
    container.appendChild(ul);
  });
  localStorage.setItem("coursesCategories", JSON.stringify(categories));
}
function nouvelleSemaine() {
  if (!confirm("Voulez-vous vraiment commencer une nouvelle semaine ? Toutes les cases seront vid√©es.")) return;
  // Vider toutes les cases du tableau
  document.querySelectorAll('.repas').forEach(input => input.value = '');
  // Supprimer les donn√©es de la semaine dans le localStorage
  localStorage.removeItem('repasSemaine');
  // Supprimer aussi la liste de courses g√©n√©r√©e
  document.getElementById("repasSemaine").innerHTML = "";
  alert("Nouvelle semaine pr√™te ! Toutes les cases ont √©t√© vid√©es.");
}

  
/* =========================
   Recette
========================= */
function chargerRecettes() {
  const data = localStorage.getItem("recettes");
  if(data) recettes = JSON.parse(data);
}
function sauvegarderRecettes() {
  localStorage.setItem("recettes", JSON.stringify(recettes));
}
function ajouterRecette() {
  const nom = document.getElementById("recetteNom").value.trim();
  const ingredients = document.getElementById("recetteIngredients").value.split(",").map(i => i.trim()).filter(i => i);
  if(!nom || ingredients.length === 0) {
    alert("Veuillez remplir le nom et les ingr√©dients !");
    return;
  }
  recettes.push({nom, ingredients});
  document.getElementById("recetteNom").value = "";
  document.getElementById("recetteIngredients").value = "";
  sauvegarderRecettes();
  afficherRecettes();
}
function afficherRecettes() {
  const ul = document.getElementById("listeRecettes");
  ul.innerHTML = "";
  recettes.forEach((recette, index) => {
    const li = document.createElement("li");
    li.style.display = "flex";
    li.style.justifyContent = "space-between";
    li.style.alignItems = "center";
    li.style.marginBottom = "5px";
    const span = document.createElement("span");
    span.textContent = `${recette.nom} (${recette.ingredients.join(", ")})`;
    li.appendChild(span);
    const btnAjouterRepas = document.createElement("button");
    btnAjouterRepas.textContent = "‚û°Ô∏è Ajouter au repas";
    btnAjouterRepas.style.padding = "6px 12px";
    btnAjouterRepas.onclick = () => ouvrirPopupRecette(index);
    li.appendChild(btnAjouterRepas);
    const btnSupprimer = document.createElement("button");
    btnSupprimer.textContent = "Supprimer";
    btnSupprimer.style.padding = "6px 12px";
    btnSupprimer.style.marginLeft = "5px";
    btnSupprimer.style.background = "#e74c3c";
    btnSupprimer.style.color = "white";
    btnSupprimer.onclick = () => {
      if(confirm(`Supprimer la recette "${recette.nom}" ?`)) {
        recettes.splice(index, 1);
        sauvegarderRecettes();
        afficherRecettes();
      }
    };
    li.appendChild(btnSupprimer);
    ul.appendChild(li);
  });
}

/* =========================
   PROPRET√â
========================= */
const tachesProprete = {
  menage: {
    "Cuisine": ["Plan de travail", "Plaques", "Sol", "Poubelle", "Nettoyage appareil"],
    "Salle de bain": ["Lavabo", "Douche", "WC", "Miroir", "Sol"],
    "Salon": ["Rangement", "Aspirateur", "Serpill√®re"],
    "Chambre": ["Draps", "Rangement", "Aspirateur"]
  },
  voiture: {
    "Int√©rieur": ["Rangement", "Aspirateur", "Tableau de bord", "Vitres"],
    "Ext√©rieur": ["Nettoyage", "S√©chage", "Cire"],
  }
};            
function afficherTaches(type) {
  const container = document.getElementById("liste-" + type);
  container.innerHTML = "";
  const data = JSON.parse(localStorage.getItem("propreteEtat_" + type)) || {};
  const pieces = tachesProprete[type];
  Object.keys(pieces).forEach(piece => {
    const divRoom = document.createElement("div");
    divRoom.className = "room";
    const titre = document.createElement("h3");
    titre.textContent = piece;
    const progressBar = document.createElement("div");
    progressBar.className = "progress-bar";
    const progressFill = document.createElement("div");
    progressFill.className = "progress-fill";
    progressBar.appendChild(progressFill);
    divRoom.appendChild(titre);
    divRoom.appendChild(progressBar);
    let total = pieces[piece].length;
    let cochees = 0;
    const majProgression = () => {
      progressFill.style.width = Math.round((cochees / total) * 100) + "%";
    };
    pieces[piece].forEach(tache => {
      const label = document.createElement("label");
      label.className = "task";
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      const key = piece + "_" + tache;
      checkbox.checked = data[key] || false;
      if (checkbox.checked) cochees++;
      checkbox.onchange = () => {
        const etat = JSON.parse(localStorage.getItem("propreteEtat_" + type)) || {};
        etat[key] = checkbox.checked;
        localStorage.setItem("propreteEtat_" + type, JSON.stringify(etat));
        cochees += checkbox.checked ? 1 : -1;
        majProgression();
      };
      const span = document.createElement("span");
      span.textContent = tache;
      label.appendChild(checkbox);
      label.appendChild(span);
      divRoom.appendChild(label);
    });
    majProgression();
    container.appendChild(divRoom);
  });
}
function resetProprete(type) {
  if (!confirm("Tout r√©initialiser ?")) return;
  localStorage.removeItem("propreteEtat_" + type);
  afficherTaches(type);
}

/* =========================
   BUDGET
========================= */
function afficherBudgetOnglet(onglet) {
  document.getElementById("budget-depenses").style.display = (onglet === 'depenses') ? 'block' : 'none';
  document.getElementById("budget-graphique").style.display = (onglet === 'graphique') ? 'block' : 'none';
  if(onglet === 'graphique') genererGraphique();
}
function genererGraphique(){
  const ctx = document.getElementById("budgetPieChart").getContext("2d");
  const legend = document.getElementById("budgetLegend");
  legend.innerHTML = "";
  const data = {};
  depenses.forEach(d => {
    const cat = d.categorie;
    const montant = parseFloat(d.montant) || 0;
    if(!data[cat]) data[cat] = 0;
    data[cat] += montant;
  });
  const total = Object.values(data).reduce((a, b) => a + b, 0);
  if(total === 0){
    ctx.clearRect(0, 0, 300, 300);
    legend.innerHTML = "<li>Aucune d√©pense enregistr√©e</li>";
    return;
  }
  const colors = ["#e74c3c","#3498db","#2ecc71","#f1c40f","#9b59b6","#1abc9c","#e67e22","#9e9e9e","#ff69b4","#8b4513"];
  ctx.clearRect(0, 0, 300, 300);
  let startAngle = 0;
  let i = 0;
  for(const cat in data){
    const sliceAngle = (data[cat] / total) * 2 * Math.PI;
    ctx.fillStyle = colors[i % colors.length];
    ctx.beginPath();
    ctx.moveTo(150, 150);
    ctx.arc(150, 150, 150, startAngle, startAngle + sliceAngle);
    ctx.closePath();
    ctx.fill();
    const li = document.createElement("li");
    li.textContent = `${cat} : ${data[cat].toFixed(2)} ‚Ç¨`;
    li.style.color = colors[i % colors.length];
    li.style.fontWeight = "bold";
    legend.appendChild(li);
    startAngle += sliceAngle;
    i++;
  }
}
// Charger
function chargerDepenses() {
  const data = localStorage.getItem("budgetDepenses");
  if(data) depenses = JSON.parse(data);
}
// Sauvegarder
function sauvegarderDepenses() {
  localStorage.setItem("budgetDepenses", JSON.stringify(depenses));
}
// Ajouter
function ajouterDepense() {
  const montant = parseFloat(document.getElementById("budgetMontant").value);
  const categorie = document.getElementById("budgetCategorie").value;
  const note = document.getElementById("budgetNote").value;
  if(!montant || montant <= 0) {
    alert("Montant invalide");
    return;
  }
  depenses.push({
    montant,
    categorie,
    note,
    date: new Date().toISOString()
  });
  document.getElementById("budgetMontant").value = "";
  document.getElementById("budgetNote").value = "";
  sauvegarderDepenses();
  afficherDepenses();
}
// Supprimer
function supprimerDepense(index) {
  depenses.splice(index, 1);
  sauvegarderDepenses();
  afficherDepenses();
}
// Afficher
function afficherDepenses() {
  const ul = document.getElementById("budgetListe");
  ul.innerHTML = "";
  const depenses = JSON.parse(localStorage.getItem("budgetDepenses")) || [];
  const depensesTriees = {};
  depenses.forEach((d, index) => {
    if (!depensesTriees[d.categorie]) depensesTriees[d.categorie] = [];
    depensesTriees[d.categorie].push({ ...d, index });
  });
  Object.keys(depensesTriees).forEach(categorie => {
    const titre = document.createElement("li");
    titre.innerHTML = `<strong>${categorie}</strong>`;
    ul.appendChild(titre);
    depensesTriees[categorie].forEach(d => {
      const li = document.createElement("li");
      li.style.display = "flex";
      li.style.justifyContent = "space-between";
      li.style.alignItems = "center";
      const span = document.createElement("span");
      span.textContent = `${d.note} : ${d.montant} ‚Ç¨`;
      const btnSupprimer = document.createElement("button");
      btnSupprimer.textContent = "Supprimer";
      btnSupprimer.style.padding = "4px 8px";
      btnSupprimer.style.marginLeft = "10px";
      btnSupprimer.style.background = "#e74c3c";
      btnSupprimer.style.color = "white";
      btnSupprimer.style.border = "none";
      btnSupprimer.style.borderRadius = "4px";
      btnSupprimer.onclick = () => {
        if (confirm("Supprimer cette d√©pense ?")) {
          depenses.splice(d.index, 1);
          localStorage.setItem("budgetDepenses", JSON.stringify(depenses));
          afficherDepenses();
        }
      };
      li.appendChild(span);
      li.appendChild(btnSupprimer);
      ul.appendChild(li);
    });
  });
  const total = depenses.reduce((s, d) => s + d.montant, 0);
  document.getElementById("budgetTotal").textContent = total.toFixed(2) + " ‚Ç¨";
}

/* =========================
   Navigation
========================= */
function afficherPage(page) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById("page-" + page).style.display = "block";
  if(page === "alimentaire") {
    afficherSousPage("inventaire");
  }
   if(page === "proprete") {
    afficherOngletProprete("menage");
  }
}
function afficherSousPage(id) { 
  document.querySelectorAll("#page-alimentaire > div[id]").forEach(d => { 
    d.style.display = "none"; }); 
  document.getElementById(id).style.display = "block"; 
}
function afficherOngletProprete(id) {
  document.querySelectorAll(".proprete-page")
    .forEach(p => p.style.display = "none");
  document.getElementById("proprete-" + id).style.display = "block";
  afficherTaches(id);
}

/* =========================
   Initialisation
========================= */
chargerAliments();
afficherAliments();
chargerDepenses();
afficherDepenses();
afficherPage("accueil");
afficherSousPage("inventaire");

</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker enregistr√©"))
    .catch(err => console.error("SW erreur", err));
}

document.addEventListener("DOMContentLoaded", () => {

  // ---------------- VARIABLES GLOBALES ----------------
  let indexEdition = -1;
  let indexRecetteEnCours = -1;

  // ---------------- POPUP MODIFIER ALIMENT ----------------
  const popupEdit = document.getElementById("popupEdit");
  const editNom = document.getElementById("editNom");
  const editQuantite = document.getElementById("editQuantite");
  const editUnite = document.getElementById("editUnite");
  const editPeremption = document.getElementById("editPeremption");
  const editSansDate = document.getElementById("editSansDate");
  const editCategorie = document.getElementById("editCategorie");

  function ouvrirPopup(index) {
    const aliment = aliments[index];
    indexEdition = index;

    editNom.value = aliment.nom;
    editQuantite.value = aliment.quantite;
    editUnite.value = aliment.unite;

    if (!aliment.peremption) {
      editSansDate.checked = true;
      editPeremption.disabled = true;
      editPeremption.style.visibility = "hidden";
      editPeremption.value = "";
    } else {
      editSansDate.checked = false;
      editPeremption.disabled = false;
      editPeremption.style.visibility = "visible";
      editPeremption.value = aliment.peremption;
    }

    editSansDate.onchange = () => {
      if (editSansDate.checked) {
        editPeremption.disabled = true;
        editPeremption.style.visibility = "hidden";
      } else {
        editPeremption.disabled = false;
        editPeremption.style.visibility = "visible";
      }
    };

    // Remplir les cat√©gories
    const options = ["Choisir Cat√©gorie","Boisson","Produit laitier","L√©gume","Fruit","Viande","Poisson","F√©culent","Sucr√©","Sauce","Epice","Sec",
                     "Plat pr√©par√©","Hygi√®ne"];
    editCategorie.innerHTML = "";
    options.forEach(cat => {
      const o = document.createElement("option");
      o.value = cat;
      o.textContent = cat;
      if (cat === aliment.categorie) o.selected = true;
      editCategorie.appendChild(o);
    });

    popupEdit.style.display = "flex";
  }

  function fermerPopup() {
    popupEdit.style.display = "none";
    indexEdition = -1;
  }

  function sauvegarderEdition() {
    if (indexEdition === -1) return;
    aliments[indexEdition] = {
      nom: editNom.value,
      quantite: editQuantite.value,
      unite: editUnite.value,
      peremption: editSansDate.checked ? null : editPeremption.value,
      categorie: editCategorie.value
    };
    sauvegarderAliments();
    afficherAliments();
    fermerPopup();
  }

  function supprimerDepuisPopup() {
    if(indexEdition === -1) return;
    if(confirm("Supprimer cet aliment ?")) {
      aliments.splice(indexEdition, 1);
      sauvegarderAliments();
      afficherAliments();
      fermerPopup();
    }
  }

  document.querySelector("#popupEdit .popup-actions button:nth-child(1)").onclick = sauvegarderEdition;
  document.querySelector("#popupEdit .popup-actions button:nth-child(2)").onclick = fermerPopup;
  document.querySelector("#popupEdit .delete-btn").onclick = supprimerDepuisPopup;


  // ---------------- POPUP AJOUTER RECETTE AU REPAS ----------------
  const popupRecette = document.getElementById("popupRecette");
  const recetteJour = document.getElementById("recetteJour");
  const recetteTypeRepas = document.getElementById("recetteTypeRepas");

  function ouvrirPopupRecette(index) {
    indexRecetteEnCours = index;
    popupRecette.style.display = "flex";
  }

  function fermerPopupRecette() {
    popupRecette.style.display = "none";
    indexRecetteEnCours = -1;
  }

  function confirmerAjoutRecette() {
    if(indexRecetteEnCours === -1) return;
    const recette = recettes[indexRecetteEnCours];
    const jour = recetteJour.value;
    const typeRepas = recetteTypeRepas.value;

    const input = document.querySelector(`input[data-jour="${jour}"][data-repas="${typeRepas}"]`);
    if(!input) {
      alert("Champ de repas non trouv√© !");
      return;
    }

    input.value = recette.ingredients.join(", ");
    fermerPopupRecette();
  }

  document.querySelector("#popupRecette .popup-actions button:nth-child(1)").onclick = confirmerAjoutRecette;
  document.querySelector("#popupRecette .popup-actions button:nth-child(2)").onclick = fermerPopupRecette;

  // ---------------- POPUP MODIFIER REPAS ----------------
  const popupRepasEdit = document.getElementById("popupRepasEdit");
  const repasTitre = document.getElementById("repasTitre");
  const repasTexte = document.getElementById("repasTexte");
  let inputRepasEnCours = null;

  function ouvrirPopupRepas(input) {
    inputRepasEnCours = input;
    repasTitre.textContent = `${input.dataset.jour} - ${input.dataset.repas}`;
    repasTexte.value = input.value;
    popupRepasEdit.style.display = "flex";
  }

  function fermerPopupRepas() {
    popupRepasEdit.style.display = "none";
    inputRepasEnCours = null;
  }

  function sauvegarderRepasPopup() {
    if(!inputRepasEnCours) return;
    inputRepasEnCours.value = repasTexte.value;
    fermerPopupRepas();
  }

  document.querySelector("#popupRepasEdit .popup-actions button:nth-child(1)").onclick = sauvegarderRepasPopup;
  document.querySelector("#popupRepasEdit .popup-actions button:nth-child(2)").onclick = fermerPopupRepas;

  // ---------------- ATTACHER LES INPUTS REPAS ----------------
  document.querySelectorAll(".repas").forEach(input => {
    input.addEventListener("click", () => ouvrirPopupRepas(input));
  });

  // ---------------- ATTACHER BOUTONS "AJOUTER AU REPAS" RECETTE ----------------
  document.querySelectorAll("#listeRecettes button").forEach((btn, i) => {
    btn.addEventListener("click", () => ouvrirPopupRecette(i));
  });

});

</script>
  
</body>
</html>























