<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mon Organisation</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#121212">

<style>
/* ==========================
   üåü STYLES G√âN√âRAUX
========================== */
body {
  font-family: Arial, sans-serif;
  margin: 0; padding: 15px;
  width: 100%;
}
h1,h2,h3 { margin: 10px 0; }
input, select, button { margin: 5px 0; padding: 10px; font-size: 1em; width: 100%; box-sizing: border-box; }
button.small { padding:6px 12px; font-size:0.9em; }

/* ==========================
   ‚ö° PAGES
========================== */
.page { display: none; }

/* ==========================
   üè† PAGE ACCUEIL
========================== */
.home-grid { display:flex; flex-direction:column; gap:20px; margin-top:40px; }
.home-btn { padding:25px; font-size:1.4em; border-radius:15px; cursor:pointer; width:100%; }

/* ==========================
   üçΩ ALIMENTAIRE
========================== */
ul { list-style:none; padding:0; max-height:400px; overflow-y:auto; margin-top:10px; }
li { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin:5px 0; border-bottom:1px solid #ccc; padding:5px; word-wrap:break-word; }
.actions { display:inline-flex; gap:6px; }

.urgent { color:red; font-weight:bold; display:flex; align-items:center; flex:1; }
.ok { color:black; display:flex; align-items:center; flex:1; }

.course-checkbox { width:20px; height:20px; cursor:pointer; }

/* ==========================
   üßΩ PROPRET√â
========================== */
.room { margin-top:20px; padding:12px; border-radius:10px; background: rgba(0,0,0,0.05); }
.task { display:flex; align-items:center; gap:10px; padding:8px 0; font-size:1.1em; }
.task input { width:22px; height:22px; }
.progress-bar { height:10px; background:#ddd; border-radius:10px; overflow:hidden; margin:6px 0 12px 0; }
.progress-fill { height:100%; width:0%; background:#2ecc71; transition: width 0.3s ease; }

/* ==========================
   üåô MODE SOMBRE
========================== */
.dark { background:#121212; color:#e0e0e0; }
.dark input, .dark select, .dark button { background:#1e1e1e; color:#e0e0e0; border:1px solid #444; }
.dark li { border-bottom:1px solid #333; }
.dark strong, .dark li span, .dark h1,h2 { color:#fff; }

/* ==========================
   üñ§ POPUPS
========================== */
.popup { position:fixed; inset:0; background: rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:1000; padding:20px; }
.popup-content { background:#1e1e1e; color:white; width:100%; max-width:500px; padding:30px; border-radius:15px; display:flex; flex-direction:column; gap:15px; max-height:90vh; overflow-y:auto; }
.popup-content input, .popup-content select, .popup-content button { font-size:1.1em; padding:12px; border-radius:10px; }
.popup-actions { display:flex; gap:10px; }
.popup-actions button { flex:1; }
.delete-btn { background:#c0392b; color:white; font-size:1.2em; padding:14px; }
</style>
</head>

<body>

<!-- ==========================
   üè† ACCUEIL
========================== -->
<div id="page-accueil" class="page">
  <h1>üè† Mon organisation</h1>
  <div class="home-grid">
    <button class="home-btn" onclick="afficherPage('alimentaire')">ü•ó Alimentaire</button>
    <button class="home-btn" onclick="afficherPage('proprete')">üßΩ Propret√©</button>
    <button class="home-btn" onclick="afficherPage('budget')">üí∞ Budget</button>
  </div>
</div>

<button class="toggle" onclick="toggleDarkMode()">üåô Mode sombre</button>

<!-- ==========================
   üçΩ ALIMENTAIRE
========================== -->
<div id="page-alimentaire" class="page">
  <h1>Gestion Alimentaire</h1>
  <button class="small" onclick="afficherPage('accueil')">‚¨Ö Retour</button>
  
  <!-- Onglets -->
  <nav class="nav">
    <button onclick="afficherSousPage('inventaire')">üì¶ Inventaire</button>
    <button onclick="afficherSousPage('repas')">üçΩÔ∏è Repas</button>
    <button onclick="afficherSousPage('recettes')">üìñ Recettes</button>
  </nav>

  <!-- ===== INVENTAIRE ===== -->
  <div id="inventaire" style="margin-bottom:10px;">
    <button onclick="exporterInventaire()">üíæ Sauvegarder</button>
    <input type="file" id="importFile" accept=".json" onchange="importerInventaire(event)">
    
    <label>Nom :</label><input type="text" id="nom" placeholder="Nom de l'aliment">
    <label>Quantit√© :</label><input type="number" id="quantite" placeholder="Quantit√©">
    <label>Unit√© :</label><input type="text" id="unite" placeholder="Ex: g, litre, pcs">

    <label>Date de p√©remption :</label>
    <div style="display:flex; gap:10px; align-items:center;">
      <input type="date" id="peremption">
      <label><input type="checkbox" id="sansDate"> Pas de DLC</label>
    </div>

    <label>Cat√©gorie :</label>
    <select id="categorie">
      <option>Choisir cat√©gorie</option>
      <option>Boisson</option>
      <option>Produit laitier</option>
      <option>L√©gume</option>
      <option>Fruit</option>
      <option>Viande</option>
      <option>Poisson</option>
      <option>F√©culent</option>
      <option>Sucr√©</option>
      <option>Sauce</option>
      <option>Epice</option>
      <option>Sec</option>
      <option>Plat pr√©par√©</option>
      <option>Hygi√®ne</option>
    </select>

    <div class="form-section">
      <button onclick="ajouterOuModifierAliment()">Ajouter</button>
    </div>

    <input type="text" id="recherche" placeholder="üîç Rechercher un aliment..." oninput="afficherAliments()">
    <h2>Liste des aliments :</h2>
    <ul id="listeAliments"></ul>
  </div>

  <!-- ===== REPAS ===== -->
  <div id="repas" style="display:none;">
    <h2>üçΩÔ∏è Repas de la semaine</h2>
    <p>Planifie les repas de la semaine :</p>
    <table border="1" cellpadding="5" cellspacing="0">
      <thead>
        <tr><th>Jour</th><th>Petit-d√©jeuner</th><th>D√©jeuner</th><th>D√Æner</th><th>Autre</th></tr>
      </thead>
      <tbody>
        <!-- G√©n√©ration dynamique par JS -->
        <script>
        const jours = ["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];
        jours.forEach(j => {
          document.write(`<tr><td>${j}</td>`+
            `<td><input type="text" class="repas" data-jour="${j}" data-repas="Petit-d√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>`+
            `<td><input type="text" class="repas" data-jour="${j}" data-repas="D√©jeuner" onclick="ouvrirPopupRepas(this)" readonly></td>`+
            `<td><input type="text" class="repas" data-jour="${j}" data-repas="D√Æner" onclick="ouvrirPopupRepas(this)" readonly></td>`+
            `<td><input type="text" class="repas" data-jour="${j}" data-repas="Autre" onclick="ouvrirPopupRepas(this)" readonly></td>`+
            `</tr>`);
        });
        </script>
    </table>
    <button onclick="nouvelleSemaine()" style="background:#e74c3c;color:white;padding:6px 12px;border:none;border-radius:5px;">Nouvelle semaine</button>
    <div style="margin-top:10px;">
      <button onclick="sauvegarderRepas()">üíæ Sauvegarder la semaine</button>
      <button onclick="chargerRepas()">üîÑ Charger la semaine</button>
      <button onclick="genererListeCourses()">üõí G√©n√©rer la liste de courses</button>
    </div>
    <div id="repasSemaine"></div>
  </div>

  <!-- ===== RECETTES ===== -->
  <div id="recettes" style="display:none;">
    <h2>üìñ Mes Recettes</h2>
    <label>Nom de la recette :</label>
    <input type="text" id="recetteNom" placeholder="Nom de la recette">
    <label>Ingr√©dients (s√©par√©s par des virgules) :</label>
    <input type="text" id="recetteIngredients" placeholder="Ex: Tomate, Lait, Oeuf">
    <button onclick="ajouterRecette()">Ajouter la recette</button>
    <h3>Liste des recettes :</h3>
    <ul id="listeRecettes"></ul>
  </div>
</div>

<!-- ==========================
   üßΩ PROPRET√â
========================== -->
<div id="page-proprete" class="page">
  <h2>üßΩ Propret√©</h2>
  <button class="small" onclick="afficherPage('accueil')">‚¨Ö Retour</button>
  <div id="listeTachesProprete"></div>
  <button onclick="resetProprete()">üîÑ Nouvelle semaine</button>
</div>

<!-- ==========================
   üí∞ BUDGET
========================== -->
<div id="page-budget" class="page">
  <h2>üí∞ Budget mensuel</h2>
  <button class="small" onclick="afficherPage('accueil')">‚¨Ö Retour</button>

  <nav class="nav">
    <button onclick="afficherBudgetOnglet('depenses')">D√©penses</button>
    <button onclick="afficherBudgetOnglet('graphique')">Graphique</button>
  </nav>

  <!-- D√©penses -->
  <div id="budget-depenses">
    <label>Montant (‚Ç¨)</label><input type="number" id="budgetMontant" placeholder="Ex: 25">
    <label>Cat√©gorie</label>
    <select id="budgetCategorie">
      <option>Nourriture</option><option>Logement</option><option>Voiture</option><option>Loisir</option><option>Sant√©</option><option>Abonnement</option><option>Autre</option>
    </select>
    <label>Description</label><input type="text" id="budgetNote" placeholder="Ex: courses lidl">
    <button onclick="ajouterDepense()">Ajouter</button>
    <hr>
    <h3>Total du mois : <span id="budgetTotal">0 ‚Ç¨</span></h3>
    <h3>D√©penses :</h3>
    <ul id="budgetListe"></ul>
  </div>

  <!-- Graphique -->
  <div id="budget-graphique" style="display:none;">
    <canvas id="budgetPieChart" width="300" height="300"></canvas>
  </div>
</div>

<!-- ==========================
   POPUPS ALIMENTAIRE
========================== -->
<div id="popupEdit" class="popup">
  <div class="popup-content">
    <h2>Modifier l'aliment</h2>
    <input id="editNom" placeholder="Nom">
    <input id="editQuantite" type="number" placeholder="Quantit√©">
    <input id="editUnite" placeholder="Unit√©">
    <div style="display:flex; gap:10px; align-items:center;">
      <input id="editPeremption" type="date">
      <label><input type="checkbox" id="editSansDate"> Pas de DLC</label>
    </div>
    <select id="editCategorie"></select>
    <div class="popup-actions">
      <button onclick="sauvegarderEdition()">üíæ Sauvegarder</button>
      <button onclick="fermerPopup()">Annuler</button>
    </div>
    <button class="delete-btn" onclick="supprimerDepuisPopup()">üóë Supprimer</button>
  </div>
</div>

<!-- ==========================
   JS COMPLET (ALIMENTAIRE / REPAS / RECETTES / PROPRET√â / BUDGET)
========================== -->
<script>
// ------------------- MODE SOMBRE -------------------
if(localStorage.getItem("darkMode")==="true") document.body.classList.add("dark");
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode",document.body.classList.contains("dark"));
}

// ------------------- ALIMENTAIRE -------------------
let aliments=[]; let indexEnCours=-1;

// Charger/sauvegarder
function chargerAliments(){const data=localStorage.getItem("aliments"); if(data) aliments=JSON.parse(data);}
function sauvegarderAliments(){localStorage.setItem("aliments",JSON.stringify(aliments));}

// Ajouter/Modifier
function ajouterOuModifierAliment(){
  const nom=document.getElementById("nom").value;
  const quantite=document.getElementById("quantite").value;
  const unite=document.getElementById("unite").value;
  const peremption=document.getElementById("sansDate").checked?null:document.getElementById("peremption").value;
  const categorie=document.getElementById("categorie").value;
  if(!nom||!quantite||!unite||!categorie){alert("Veuillez remplir tous les champs !");return;}
  const nouvelAliment={nom,quantite,unite,peremption,categorie};
  if(indexEnCours===-1) aliments.push(nouvelAliment);
  else {aliments[indexEnCours]=nouvelAliment; indexEnCours=-1; document.querySelector("button[onclick='ajouterOuModifierAliment()']").textContent="Ajouter";}
  document.getElementById("nom").value=""; document.getElementById("quantite").value="";
  document.getElementById("unite").value=""; document.getElementById("peremption").value="";
  document.getElementById("categorie").value="Choisir cat√©gorie"; document.getElementById("sansDate").checked=false;
  sauvegarderAliments(); afficherAliments();
}

// Affichage
function calculerJoursRestants(dateString){
  if(!dateString) return null;
  const diff=Math.ceil((new Date(dateString)-new Date())/(1000*60*60*24)); return diff<0?0:diff;
}
function afficherAliments(){
  const recherche=document.getElementById("recherche").value.toLowerCase();
  const ul=document.getElementById("listeAliments"); ul.innerHTML="";
  const ordre=["F√©culent","Produit laitier","Viande","Poisson","Fruit","L√©gume","Sucr√©","Sec","Sauce","Epice","Boisson","Plat pr√©par√©","Hygi√®ne"];
  aliments.sort((a,b)=>ordre.indexOf(a.categorie)-ordre.indexOf(b.categorie));
  let catActuelle="";
  aliments.forEach((a,i)=>{
    if(!a.nom.toLowerCase().includes(recherche)) return;
    if(a.categorie!==catActuelle){catActuelle=a.categorie; const titre=document.createElement("li"); titre.innerHTML=`<strong>${catActuelle}</strong>`; ul.appendChild(titre);}
    const li=document.createElement("li"); li.style.cursor="pointer";
    li.onclick=(e)=>{if(e.target.tagName!=="BUTTON") ouvrirPopup(i);};
    let texte=`${a.nom} - ${a.quantite} ${a.unite}`;
    const jours=calculerJoursRestants(a.peremption);
    texte+=jours!==null?` - ${jours} jour(s) restant`:" - Dur√©e illimit√©e";
    li.className=(jours!==null && jours<=3)?"urgent":"ok";
    if(jours!==null && jours<=3) texte+=" - URGENT !";
    const spanTexte=document.createElement("span"); spanTexte.textContent=texte; li.appendChild(spanTexte);
    const btnSuppr=document.createElement("button"); btnSuppr.textContent="Supprimer"; btnSuppr.style.background="#e74c3c"; btnSuppr.style.color="white"; btnSuppr.style.border="none"; btnSuppr.style.borderRadius="6px";
    btnSuppr.onclick=()=>supprimerAliment(i);
    const actions=document.createElement("span"); actions.className="actions"; actions.appendChild(btnSuppr); li.appendChild(actions);
    ul.appendChild(li);
  });
}
function supprimerAliment(index){if(confirm("Voulez-vous vraiment supprimer cet aliment ?")){aliments.splice(index,1); sauvegarderAliments(); afficherAliments();}}

// ------------------- POPUP ALIMENTAIRE -------------------
let indexEdition=-1;
function ouvrirPopup(index){
  const a=aliments[index]; indexEdition=index;
  document.getElementById("editNom").value=a.nom;
  document.getElementById("editQuantite").value=a.quantite;
  document.getElementById("editUnite").value=a.unite;
  const cb=document.getElementById("editSansDate"); cb.checked=!a.peremption; document.getElementById("editPeremption").value=a.peremption||"";
  const select=document.getElementById("editCategorie"); select.innerHTML=""; ["Boisson","Produit laitier","L√©gume","Fruit","Viande","Poisson","F√©culent","Sucr√©","Sauce","Epice","Sec","Plat pr√©par√©","Hygi√®ne"].forEach(c=>{const o=document.createElement("option"); o.value=o.textContent=c; if(c===a.categorie)o.selected=true; select.appendChild(o);});
  document.getElementById("popupEdit").style.display="flex";
}
function fermerPopup(){document.getElementById("popupEdit").style.display="none";}
function sauvegarderEdition(){const a=aliments[indexEdition]; a.nom=document.getElementById("editNom").value; a.quantite=document.getElementById("editQuantite").value; a.unite=document.getElementById("editUnite").value; a.peremption=document.getElementById("editSansDate").checked?null:document.getElementById("editPeremption").value; a.categorie=document.getElementById("editCategorie").value; sauvegarderAliments(); afficherAliments(); fermerPopup();}
function supprimerDepuisPopup(){if(confirm("Supprimer ?")){aliments.splice(indexEdition,1); sauvegarderAliments(); afficherAliments(); fermerPopup();}}

// ------------------- REPAS -------------------
let repasSemaine={};
function nouvelleSemaine(){jours.forEach(j=>{["Petit-d√©jeuner","D√©jeuner","D√Æner","Autre"].forEach(r=>{repasSemaine[`${j}-${r}`]="";});}); afficherRepas();}
function afficherRepas(){document.querySelectorAll(".repas").forEach(input=>{const key=`${input.dataset.jour}-${input.dataset.repas}`; input.value=repasSemaine[key]||"";});}
function ouvrirPopupRepas(input){const key=`${input.dataset.jour}-${input.dataset.repas}`; const val=prompt(`Entrer le repas pour ${key}:`,repasSemaine[key]||""); if(val!==null){repasSemaine[key]=val; input.value=val; sauvegarderRepas();}}
function sauvegarderRepas(){localStorage.setItem("repasSemaine",JSON.stringify(repasSemaine));}
function chargerRepas(){const data=localStorage.getItem("repasSemaine"); if(data){repasSemaine=JSON.parse(data); afficherRepas();}}

// ------------------- RECETTES -------------------
let recettes=[];
function ajouterRecette(){const nom=document.getElementById("recetteNom").value; const ing=document.getElementById("recetteIngredients").value.split(",").map(s=>s.trim()); if(!nom||ing.length===0){alert("Remplir tous les champs");return;} recettes.push({nom,ing}); afficherRecettes(); document.getElementById("recetteNom").value=""; document.getElementById("recetteIngredients").value="";}
function afficherRecettes(){const ul=document.getElementById("listeRecettes"); ul.innerHTML=""; recettes.forEach((r,i)=>{const li=document.createElement("li"); li.textContent=`${r.nom} - ${r.ing.join(", ")}`; const btn=document.createElement("button"); btn.textContent="Supprimer"; btn.onclick=()=>{recettes.splice(i,1); afficherRecettes();}; li.appendChild(btn); ul.appendChild(li);});}

// ------------------- PROPRET√â -------------------
let tachesProprete=[{nom:"Chambre",taches:["Faire le lit","Passer l'aspirateur","Changer les draps"]},{nom:"Salle de bain",taches:["Nettoyer lavabo","Nettoyer douche","Passer la serpilli√®re"]},{nom:"Cuisine",taches:["Laver vaisselle","Nettoyer plan de travail","Passer l'aspirateur"]}];
function resetProprete(){tachesProprete.forEach(r=>r.taches=r.taches.map(()=>false)); afficherProprete();}
function afficherProprete(){const div=document.getElementById("listeTachesProprete"); div.innerHTML=""; tachesProprete.forEach(r=>{const room=document.createElement("div"); room.className="room"; const h=document.createElement("h3"); h.textContent=r.nom; room.appendChild(h); r.taches.forEach((t,i)=>{const p=document.createElement("div"); p.className="task"; const cb=document.createElement("input"); cb.type="checkbox"; cb.checked=t; cb.onchange=()=>{r.taches[i]=cb.checked;}); const span=document.createElement("span"); span.textContent=tachesProprete[r.nom]?t:""+t; p.appendChild(cb); p.appendChild(span); room.appendChild(p);}); div.appendChild(room);});}
resetProprete();

// ------------------- BUDGET -------------------
let depenses=[];
function ajouterDepense(){const montant=parseFloat(document.getElementById("budgetMontant").value); const cat=document.getElementById("budgetCategorie").value; const note=document.getElementById("budgetNote").value; if(isNaN(montant)||!cat||!note){alert("Remplir tous les champs");return;} depenses.push({montant,cat,note}); sauvegarderBudget(); afficherBudget();}
function sauvegarderBudget(){localStorage.setItem("depenses",JSON.stringify(depenses));}
function afficherBudget(){const ul=document.getElementById("budgetListe"); ul.innerHTML=""; let total=0; depenses.forEach((d,i)=>{total+=d.montant; const li=document.createElement("li"); li.textContent=`${d.note} - ${d.cat} - ${d.montant} ‚Ç¨`; const btn=document.createElement("button"); btn.textContent="Supprimer"; btn.onclick=()=>{depenses.splice(i,1); sauvegarderBudget(); afficherBudget();}; li.appendChild(btn); ul.appendChild(li);}); document.getElementById("budgetTotal").textContent=total+" ‚Ç¨";}
function afficherBudgetOnglet(onglet){document.getElementById("budget-depenses").style.display=onglet==="depenses"?"block":"none"; document.getElementById("budget-graphique").style.display=onglet==="graphique"?"block":"none"; if(onglet==="graphique") genererGraphique();}
function genererGraphique(){const ctx=document.getElementById("budgetPieChart").getContext("2d"); const data={}; depenses.forEach(d=>{data[d.cat]=(data[d.cat]||0)+d.montant;}); const total=Object.values(data).reduce((a,b)=>a+b,0); ctx.clearRect(0,0,300,300); let start=0; const colors=["#e74c3c","#3498db","#2ecc71","#f1c40f","#9b59b6","#1abc9c","#e67e22"]; let i=0; for(const cat in data){const slice=(data[cat]/total)*2*Math.PI; ctx.fillStyle=colors[i%colors.length]; ctx.beginPath(); ctx.moveTo(150,150); ctx.arc(150,150,150,start,start+slice); ctx.closePath(); ctx.fill(); start+=slice; i++; }}

// ------------------- NAVIGATION -------------------
function afficherPage(page){document.querySelectorAll(".page").forEach(p=>p.style.display="none");document.getElementById("page-"+page).style.display="block";}
function afficherSousPage(sous){document.getElementById("inventaire").style.display="none"; document.getElementById("repas").style.display="none"; document.getElementById("recettes").style.display="none"; document.getElementById(sous).style.display="block";}

// ------------------- INIT -------------------
chargerAliments(); afficherAliments();
chargerRepas();
afficherRecettes();
</script>
</body>
</html>
